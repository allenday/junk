<!DOCTYPE html><meta charset="utf-8"><svg width="960" height="600"></svg><script src="https://d3js.org/d3.v4.min.js"></script><script>var baseNodes = [
{id:"168cf0",group:0,label:"168cf0",level:1},{id:"388c3f",group:0,label:"388c3f",level:1},{id:"206376",group:0,label:"206376",level:1},{id:"d9321d",group:0,label:"d9321d",level:1},{id:"007d3b",group:0,label:"007d3b",level:1},{id:"dc0568",group:0,label:"dc0568",level:1},{id:"6a94d1",group:0,label:"6a94d1",level:1},{id:"1a3125",group:0,label:"1a3125",level:1},{id:"14af12",group:0,label:"14af12",level:1},{id:"67f11b",group:0,label:"67f11b",level:1},{id:"8d12a1",group:0,label:"8d12a1",level:1},{id:"ea5615",group:0,label:"ea5615",level:1},{id:"571cb8",group:0,label:"571cb8",level:1},{id:"99fe39",group:0,label:"99fe39",level:1},{id:"0ac913",group:0,label:"0ac913",level:1},{id:"2d9e8c",group:0,label:"2d9e8c",level:1},{id:"fd2cf1",group:0,label:"fd2cf1",level:1},{id:"26a7f4",group:0,label:"26a7f4",level:1},{id:"ebceb5",group:0,label:"ebceb5",level:1},{id:"d8bc3a",group:0,label:"d8bc3a",level:1},{id:"db63d4",group:0,label:"db63d4",level:1},{id:"00febf",group:0,label:"00febf",level:1},{id:"606af0",group:0,label:"606af0",level:1},{id:"00cb38",group:0,label:"00cb38",level:1},{id:"8da0d8",group:0,label:"8da0d8",level:1},{id:"f3d5fd",group:0,label:"f3d5fd",level:1},{id:"7cd085",group:0,label:"7cd085",level:1},{id:"8c19ee",group:0,label:"8c19ee",level:1},{id:"33bcbd",group:0,label:"33bcbd",level:1},{id:"2ff209",group:0,label:"2ff209",level:1},{id:"bebe34",group:0,label:"bebe34",level:1},{id:"3344a2",group:0,label:"3344a2",level:1},{id:"6f4a3c",group:0,label:"6f4a3c",level:1},{id:"txaddr",group:0,label:"txaddr",level:1},{id:"afee8c",group:0,label:"afee8c",level:1},{id:"09f86e",group:0,label:"09f86e",level:1},{id:"6546fa",group:0,label:"6546fa",level:1},{id:"70216d",group:0,label:"70216d",level:1},{id:"60c028",group:0,label:"60c028",level:1},{id:"ed3319",group:0,label:"ed3319",level:1},{id:"6b04c2",group:0,label:"6b04c2",level:1},{id:"005f4a",group:0,label:"005f4a",level:1},{id:"478f25",group:0,label:"478f25",level:1},{id:"569418",group:0,label:"569418",level:1},{id:"b96841",group:0,label:"b96841",level:1},{id:"8f077c",group:0,label:"8f077c",level:1},{id:"924c25",group:0,label:"924c25",level:1},{id:"a8458b",group:0,label:"a8458b",level:1},{id:"187518",group:0,label:"187518",level:1},{id:"007308",group:0,label:"007308",level:1},{id:"22f365",group:0,label:"22f365",level:1},{id:"1401a9",group:0,label:"1401a9",level:1},{id:"c22d5b",group:0,label:"c22d5b",level:1},{id:"20abf6",group:0,label:"20abf6",level:1},{id:"3ab65a",group:0,label:"3ab65a",level:1},{id:"00e28d",group:0,label:"00e28d",level:1},{id:"1d37d2",group:0,label:"1d37d2",level:1},{id:"006616",group:0,label:"006616",level:1},{id:"b325eb",group:0,label:"b325eb",level:1},{id:"84b038",group:0,label:"84b038",level:1},{id:"739200",group:0,label:"739200",level:1},{id:"txfrom",group:0,label:"txfrom",level:1},{id:"fd82a5",group:0,label:"fd82a5",level:1},{id:"003c6d",group:0,label:"003c6d",level:1},{id:"f4b51b",group:0,label:"f4b51b",level:1},{id:"8448fa",group:0,label:"8448fa",level:1},{id:"192fec",group:0,label:"192fec",level:1},{id:"c0a308",group:0,label:"c0a308",level:1},{id:"6a40f7",group:0,label:"6a40f7",level:1},{id:"ed5020",group:0,label:"ed5020",level:1},{id:"7f3303",group:0,label:"7f3303",level:1},{id:"001582",group:0,label:"001582",level:1},{id:"f97100",group:0,label:"f97100",level:1},{id:"0032c1",group:0,label:"0032c1",level:1},{id:"176825",group:0,label:"176825",level:1},{id:"083578",group:0,label:"083578",level:1},{id:"6499cc",group:0,label:"6499cc",level:1},{id:"87d3da",group:0,label:"87d3da",level:1},{id:"1c4f45",group:0,label:"1c4f45",level:1},{id:"008d98",group:0,label:"008d98",level:1},{id:"d4aee2",group:0,label:"d4aee2",level:1},{id:"b88f38",group:0,label:"b88f38",level:1},{id:"c6ee6c",group:0,label:"c6ee6c",level:1},{id:"239a95",group:0,label:"239a95",level:1},{id:"d046b3",group:0,label:"d046b3",level:1},{id:"76fb08",group:0,label:"76fb08",level:1},{id:"088715",group:0,label:"088715",level:1},{id:"21b115",group:0,label:"21b115",level:1},{id:"00dba8",group:0,label:"00dba8",level:1},{id:"bf1508",group:0,label:"bf1508",level:1},{id:"4be06d",group:0,label:"4be06d",level:1},{id:"f2eeab",group:0,label:"f2eeab",level:1},{id:"502ee1",group:0,label:"502ee1",level:1},{id:"45e1e6",group:0,label:"45e1e6",level:1},{id:"af2506",group:0,label:"af2506",level:1},{id:"efbea7",group:0,label:"efbea7",level:1},{id:"d31668",group:0,label:"d31668",level:1},{id:"007a36",group:0,label:"007a36",level:1},{id:"abcb11",group:0,label:"abcb11",level:1},{id:"2a2949",group:0,label:"2a2949",level:1},{id:"a3b2d1",group:0,label:"a3b2d1",level:1},{id:"1829d7",group:0,label:"1829d7",level:1},{id:"4ad8a3",group:0,label:"4ad8a3",level:1}]
var baseLinks = [
{target:"txaddr",source:"txfrom",strength:"0"},{target:"b88f38",source:"a3b2d1",strength:"18.6050834752662"},{target:"569418",source:"a3b2d1",strength:"20.0301186583865"},{target:"abcb11",source:"a3b2d1",strength:"17.9994672941142"},{target:"7cd085",source:"a3b2d1",strength:"18.8261458587272"},{target:"1829d7",source:"a3b2d1",strength:"16.5880993427041"},{target:"afee8c",source:"a3b2d1",strength:"18.8135670766047"},{target:"00febf",source:"7cd085",strength:"6.90875477931522"},{target:"fd82a5",source:"7cd085",strength:"6.90875477931522"},{target:"007308",source:"7cd085",strength:"6.90875477931522"},{target:"8c19ee",source:"7cd085",strength:"6.90875477931522"},{target:"33bcbd",source:"7cd085",strength:"6.21660610108486"},{target:"c22d5b",source:"7cd085",strength:"8.5582065276295"},{target:"739200",source:"7cd085",strength:"7.60140233458373"},{target:"db63d4",source:"1829d7",strength:"16.5235608257331"},{target:"db63d4",source:"b88f38",strength:"18.6050834752662"},{target:"afee8c",source:"1829d7",strength:"15.4249486703984"},{target:"8da0d8",source:"478f25",strength:"20.7232658379464"},{target:"8da0d8",source:"b96841",strength:"20.7232658379464"},{target:"187518",source:"1829d7",strength:"13.8155115579638"},{target:"00febf",source:"afee8c",strength:"11.0917272378731"},{target:"1a3125",source:"afee8c",strength:"10.3498066546526"},{target:"f97100",source:"afee8c",strength:"12.2468994400389"},{target:"571cb8",source:"afee8c",strength:"10.6621727545667"},{target:"8da0d8",source:"569418",strength:"135.999146549453"},{target:"606af0",source:"afee8c",strength:"18.8433989422652"},{target:"8da0d8",source:"99fe39",strength:"20.7232658379464"},{target:"0ac913",source:"7cd085",strength:"13.3455085287173"},{target:"8da0d8",source:"00e28d",strength:"20.7232658379464"},{target:"f4b51b",source:"7cd085",strength:"12.9400442286075"},{target:"206376",source:"7cd085",strength:"18.8190985849704"},{target:"088715",source:"abcb11",strength:"16.8112428815183"},{target:"3344a2",source:"abcb11",strength:"14.3953296156171"},{target:"8f077c",source:"abcb11",strength:"14.9061550142632"},{target:"c0a308",source:"abcb11",strength:"14.9061550142632"},{target:"8da0d8",source:"007d3b",strength:"20.7232658379464"},{target:"8da0d8",source:"2ff209",strength:"20.7232658379464"},{target:"8da0d8",source:"239a95",strength:"20.7232658379464"},{target:"001582",source:"abcb11",strength:"13.2967184525477"},{target:"8da0d8",source:"4ad8a3",strength:"20.7232658379464"},{target:"4be06d",source:"abcb11",strength:"13.2967184525477"},{target:"8da0d8",source:"6a94d1",strength:"20.7232658379464"},{target:"7f3303",source:"569418",strength:"20.0301186583865"},{target:"8da0d8",source:"7f3303",strength:"20.7232658379464"},{target:"8da0d8",source:"6499cc",strength:"20.7232658379464"},{target:"d046b3",source:"00febf",strength:"9.90353755128617"},{target:"8d12a1",source:"d046b3",strength:"9.90353755128617"},{target:"8d12a1",source:"d9321d",strength:"9.90353755128617"},{target:"8d12a1",source:"d046b3",strength:"9.90353755128617"},{target:"8d12a1",source:"ed5020",strength:"9.21044036697652"},{target:"6b04c2",source:"6f4a3c",strength:"8.00670084544037"},{target:"20abf6",source:"efbea7",strength:"10.582599292693"},{target:"8d12a1",source:"007a36",strength:"10.3089859934221"},{target:"8d12a1",source:"ed3319",strength:"7.47929963778283"},{target:"8d12a1",source:"2d9e8c",strength:"10.582599292693"},{target:"8d12a1",source:"6a40f7",strength:"9.15292310110623"},{target:"67f11b",source:"a8458b",strength:"10.0949004698889"},{target:"8d12a1",source:"d31668",strength:"10.582599292693"},{target:"8d12a1",source:"083578",strength:"10.58258651737"},{target:"8d12a1",source:"ed5020",strength:"9.21044036697652"},{target:"8d12a1",source:"00dba8",strength:"9.21044036697652"},{target:"8d12a1",source:"083578",strength:"10.58258651737"},{target:"8d12a1",source:"6f4a3c",strength:"8.7721454392451"},{target:"0032c1",source:"006616",strength:"10.5817913441653"},{target:"8d12a1",source:"ed5020",strength:"9.21044036697652"},{target:"005f4a",source:"008d98",strength:"10.582599292693"},{target:"8d12a1",source:"d9321d",strength:"9.87521687051807"},{target:"8d12a1",source:"168cf0",strength:"10.5549309175943"},{target:"8d12a1",source:"af2506",strength:"10.582599292693"},{target:"2a2949",source:"192fec",strength:"10.582599292693"},{target:"388c3f",source:"1c4f45",strength:"9.21044036697652"},{target:"8d12a1",source:"00dba8",strength:"10.290194619753"},{target:"8d12a1",source:"09f86e",strength:"0.693147180559945"},{target:"8d12a1",source:"f3d5fd",strength:"8.5173931714189"},{target:"bf1508",source:"1401a9",strength:"10.582599292693"},{target:"8d12a1",source:"14af12",strength:"9.47239689678899"},{target:"ea5615",source:"6546fa",strength:"10.582599292693"},{target:"60c028",source:"502ee1",strength:"10.3886510782878"},{target:"76fb08",source:"00cb38",strength:"8.68406264365127"},{target:"d8bc3a",source:"dc0568",strength:"10.582599292693"},{target:"21b115",source:"3ab65a",strength:"10.582599292693"},{target:"f2eeab",source:"c6ee6c",strength:"8.6949795840488"},{target:"8d12a1",source:"26a7f4",strength:"8.68315329328299"},{target:"8d12a1",source:"87d3da",strength:"8.5173931714189"},{target:"d8bc3a",source:"dc0568",strength:"10.582599292693"},{target:"d8bc3a",source:"dc0568",strength:"10.582599292693"},{target:"8d12a1",source:"b325eb",strength:"10.3089859934221"},{target:"8d12a1",source:"84b038",strength:"9.21044036697652"},{target:"d8bc3a",source:"dc0568",strength:"10.582599292693"},{target:"005f4a",source:"008d98",strength:"10.582599292693"},{target:"8d12a1",source:"b325eb",strength:"9.21044036697652"},{target:"8d12a1",source:"176825",strength:"9.61587214452889"},{target:"8d12a1",source:"45e1e6",strength:"8.04334217044161"},{target:"8d12a1",source:"388c3f",strength:"9.21044036697652"},{target:"8d12a1",source:"bebe34",strength:"9.90353755128617"},{target:"1d37d2",source:"8448fa",strength:"0.693147180559945"},{target:"fd2cf1",source:"d4aee2",strength:"8.68404148567545"},{target:"ebceb5",source:"924c25",strength:"9.87521687051807"},{target:"8d12a1",source:"22f365",strength:"8.68521296349933"},{target:"70216d",source:"003c6d",strength:"10.5825977951006"}]
var nodes = [...baseNodes]
var links = [...baseLinks]
function getNeighbors(node) {
  return baseLinks.reduce(function (neighbors, link) {
      if (link.target.id === node.id) {
        neighbors.push(link.source.id)
      } else if (link.source.id === node.id) {
        neighbors.push(link.target.id)
      }
      return neighbors
    },
    [node.id]
  )
}
function isNeighborLink(node, link) {
  return link.target.id === node.id || link.source.id === node.id
}
function getNodeColor(node, neighbors) {
  if (Array.isArray(neighbors) && neighbors.indexOf(node.id) > -1) {
    return node.level === 1 ? 'blue' : 'green'
  }
  return node.level === 1 ? 'red' : 'gray'
}
function getLinkColor(node, link) {
  return isNeighborLink(node, link) ? 'green' : '#E5E5E5'
}
function getTextColor(node, neighbors) {
  return Array.isArray(neighbors) && neighbors.indexOf(node.id) > -1 ? 'green' : 'black'
}
var width = window.innerWidth
var height = window.innerHeight
var svg = d3.select('svg')
svg.attr('width', width).attr('height', height)
var linkElements,
  nodeElements,
  textElements
// we use svg groups to logically group the elements together
var linkGroup = svg.append('g').attr('class', 'links')
var nodeGroup = svg.append('g').attr('class', 'nodes')
var textGroup = svg.append('g').attr('class', 'texts')
// we use this reference to select/deselect
// after clicking the same element twice
var selectedId
// simulation setup with all forces
var linkForce = d3
  .forceLink()
  .id(function (link) { return link.id })
  .strength(function (link) { return link.strength })
var simulation = d3
  .forceSimulation()
  .force('link', linkForce)
  .force('charge', d3.forceManyBody().strength(-120))
  .force('center', d3.forceCenter(width / 2, height / 2))
var dragDrop = d3.drag().on('start', function (node) {
  node.fx = node.x
  node.fy = node.y
}).on('drag', function (node) {
  simulation.alphaTarget(0.7).restart()
  node.fx = d3.event.x
  node.fy = d3.event.y
}).on('end', function (node) {
  if (!d3.event.active) {
    simulation.alphaTarget(0)
  }
  node.fx = null
  node.fy = null
})
// select node is called on every click
// we either update the data according to the selection
// or reset the data if the same node is clicked twice
function selectNode(selectedNode) {
  if (selectedId === selectedNode.id) {
    selectedId = undefined
    resetData()
    updateSimulation()
  } else {
    selectedId = selectedNode.id
    updateData(selectedNode)
    updateSimulation()
  }
  var neighbors = getNeighbors(selectedNode)
  // we modify the styles to highlight selected nodes
  nodeElements.attr('fill', function (node) { return getNodeColor(node, neighbors) })
  textElements.attr('fill', function (node) { return getTextColor(node, neighbors) })
  linkElements.attr('stroke', function (link) { return getLinkColor(selectedNode, link) })
}
// this helper simple adds all nodes and links
// that are missing, to recreate the initial state
function resetData() {
  var nodeIds = nodes.map(function (node) { return node.id })
  baseNodes.forEach(function (node) {
    if (nodeIds.indexOf(node.id) === -1) {
      nodes.push(node)
    }
  })
  links = baseLinks
}
// diffing and mutating the data
function updateData(selectedNode) {
  var neighbors = getNeighbors(selectedNode)
  var newNodes = baseNodes.filter(function (node) {
    return neighbors.indexOf(node.id) > -1 || node.level === 1
  })
  var diff = {
    removed: nodes.filter(function (node) { return newNodes.indexOf(node) === -1 }),
    added: newNodes.filter(function (node) { return nodes.indexOf(node) === -1 })
  }
  diff.removed.forEach(function (node) { nodes.splice(nodes.indexOf(node), 1) })
  diff.added.forEach(function (node) { nodes.push(node) })
  links = baseLinks.filter(function (link) {
    return link.target.id === selectedNode.id || link.source.id === selectedNode.id
  })
}
function updateGraph() {
  // links
  linkElements = linkGroup.selectAll('line')
    .data(links, function (link) {
      return link.target.id + link.source.id
    })
  linkElements.exit().remove()
  var linkEnter = linkElements
    .enter().append('line')
    .attr('stroke-width', 1)
    .attr('stroke', 'rgba(50, 50, 50, 0.2)')
  linkElements = linkEnter.merge(linkElements)
  // nodes
  nodeElements = nodeGroup.selectAll('circle')
    .data(nodes, function (node) { return node.id })
  nodeElements.exit().remove()
  var nodeEnter = nodeElements
    .enter()
    .append('circle')
    .attr('r', 10)
    .attr('fill', function (node) { return node.level === 1 ? 'red' : 'gray' })
    .call(dragDrop)
    // we link the selectNode method here
    // to update the graph on every click
    .on('click', selectNode)
  nodeElements = nodeEnter.merge(nodeElements)
  // texts
  textElements = textGroup.selectAll('text')
    .data(nodes, function (node) { return node.id })
  textElements.exit().remove()
  var textEnter = textElements
    .enter()
    .append('text')
    .text(function (node) { return node.label })
    .attr('font-size', 15)
    .attr('dx', 15)
    .attr('dy', 4)
  textElements = textEnter.merge(textElements)
}
function updateSimulation() {
  updateGraph()
  simulation.nodes(nodes).on('tick', () => {
    nodeElements
      .attr('cx', function (node) { return node.x })
      .attr('cy', function (node) { return node.y })
    textElements
      .attr('x', function (node) { return node.x })
      .attr('y', function (node) { return node.y })
    linkElements
      .attr('x1', function (link) { return link.source.x })
      .attr('y1', function (link) { return link.source.y })
      .attr('x2', function (link) { return link.target.x })
      .attr('y2', function (link) { return link.target.y })
  })
  simulation.force('link').links(links)
  simulation.alphaTarget(0.7).restart()
}
// last but not least, we call updateSimulation
// to trigger the initial render
updateSimulation()
</script>
